---
title: "Bivariate Analysis"
author: "Megan Beaudry"
date: "11/4/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Bivariate Analysis Script

Start by loading the libraries below. Please install them if you have not already. 
```{r library}
library(readxl)
library(dplyr)
library(tidyverse)
library(forcats)
library(ggthemes)
library(plotly)
library(knitr)
library(naniar)
library(broom)
library(gridExtra)
library(zoo)
library(ggpubr)
library(ggplot2)
library(ggthemes)
library(RColorBrewer)
library(dplyr)
library(caret)
library(tidyverse)
library(kableExtra)
library(xtable)
```


#load the data
Now lets load the clean data. 
```{r load data}
clean_water_quality_data <- readRDS("../../data/processed_data/clean_water_quality_data.rds")
#if you get an error - this happens because you need to save the file first cause it refers to a relative path 
```



#TABLES
Lets start with positives by site....

We have more libraries to load that focus on just the table
```{r load libraries}
library('tigerstats')
library('formattable')
library('gridExtra')
```

We aim to get the frequency of occurance with a lot of our tables. 
To do this we need to alter the data first. 
We will set the anything below the LOD as being "not detected" or NO.
We will set anything above the LOD as being "detected" or YES.
Remember that each marker has a different LOD, and that LOD can vary lab, person performing the protocol and a host of other variables. As such, we will use the LOD that was determined when I was running these samples in Edmonton. 
Again, we are doing this for all our qPCR data. 
```{r data cleaning for tables}
#lets make a new object in case we mess something up
new_wq <- clean_water_quality_data
new_wq$arco_new <- new_wq$A_butzleri_HSP60
new_wq$HF183_new <- new_wq$HF183
unique(new_wq$arco_new)
str(new_wq)

#convert characters to categorical varaibles
new_wq$Pond <- as.factor(as.character(new_wq$Pond))
new_wq$Sampling_Site <- as.factor(as.character(new_wq$Sampling_Site))
new_wq$Sampling_Site <- as.factor(as.character(new_wq$Sampling_Site))
str(new_wq)

#want to convert a new column with acro as yes or no to get the percent of the samples positive 
#lets do arco first
new_wq <- new_wq %>% mutate(arco_y_n= 
                      ifelse(arco_new < "3.391993", "no",
                      ifelse(arco_new > "3.391994", "yes",
                      "no")))
#Now HF183 and the rest
new_wq <- new_wq %>% mutate(HF183_y_n= 
                      ifelse(HF183_new < "3.329601", "no",
                      ifelse(HF183_new > "3.329602", "yes",
                      "no")))
new_wq <- new_wq %>% mutate(HumM2_y_n= 
                      ifelse(HumM2 < "3.847449", "no",
                      ifelse(HumM2 > "3.847450", "yes",
                      "no")))
new_wq <- new_wq %>% mutate(CG01_y_n= 
                      ifelse(CG01 < "3.108565", "no",
                      ifelse(CG01 > "3.108566", "yes",
                      "no")))
new_wq <- new_wq %>% mutate(LeeSg_y_n= 
                      ifelse(LeeSg < "3.283979", "no",
                      ifelse(LeeSg > "3.283980", "yes",
                      "no")))
new_wq <- new_wq %>% mutate(Dog3_y_n= 
                      ifelse(Dog3 < "3.156549", "no",
                      ifelse(Dog3 > "3.156550", "yes",
                      "no")))
new_wq <- new_wq %>% mutate(MuBac_y_n= 
                      ifelse(MuBac < "3.554852", "no",
                      ifelse(MuBac > "3.554853", "yes",
                      "no")))
new_wq <- new_wq %>% mutate(Rum2Bac_y_n= 
                      ifelse(Rum2Bac < "3.457125", "no",
                      ifelse(Rum2Bac > "3.457126", "yes",
                      "no")))
new_wq <- new_wq %>% mutate(Salmonella_y_n= 
                      ifelse(Salmonella_spp_InvA < "3.170848", "no",
                      ifelse(Salmonella_spp_InvA > "3.170849", "yes",
                      "no")))
new_wq <- new_wq %>% mutate(Campy_y_n= 
                      ifelse(Campylobacter_spp_Van_Dkye < "3.554852", "no",
                      ifelse(Campylobacter_spp_Van_Dkye > "3.554853", "yes",
                      "no")))

#water quality indicators
new_wq <- new_wq %>% mutate(Entero_y_n= 
                      ifelse(Enterococcus_CCE < "3.102", "no",
                      ifelse(Enterococcus_CCE > "3.103", "yes",
                      "no")))

new_wq <- new_wq %>% mutate(thermo_y_n= 
                      ifelse(thermotolerant_coliforms < "2.602", "no",
                      ifelse(thermotolerant_coliforms > "2.603", "yes",
                      "no")))
```




## Tables Part 1: Water Quality Indicators
First, we are to make tables for the wate quality indicators. The frequency of occurance will be broken down by pond.
```{r by pond - water quality - percent}
#Enterococcus
#make two way table
xtabs(~Pond+Entero_y_n, data=new_wq)
#rowPerc is a function that will compute row percentages for a given twoway table in r
Entero_Pond<- rowPerc(xtabs(~Pond+Entero_y_n, data=new_wq))
#save table
png("../../results/Entero_pond_table.png", height=400, width=400)
p<-tableGrob(Entero_Pond)
grid.arrange(p)
dev.off()

#thermotolerant coliforms
#make two way table, computer row percents, save table
xtabs(~Pond+thermo_y_n, data=new_wq)
thermo_pond<- rowPerc(xtabs(~Pond+thermo_y_n, data=new_wq))
png("../../results/thermo_pond_table.png", height=400, width=400)
p<-tableGrob(thermo_pond)
grid.arrange(p)
dev.off()
```

Let's break it down further by samplign site. 
```{r by site - water quality - percent}
#Entero by site
#make two way table, computer row percents, save table
xtabs(~Sampling_Site+Entero_y_n, data=new_wq)
Entero_y_n_site<- rowPerc(xtabs(~Sampling_Site+Entero_y_n, data=new_wq))
png("../../results/Entero_y_n_site_table.png", height=400, width=400)
p<-tableGrob(Entero_y_n_site)
grid.arrange(p)
dev.off()

#Thermotoler coliforms by site
#make two way table, computer row percents, save table
xtabs(~Sampling_Site+thermo_y_n, data=new_wq)
thermo_y_n_site<- rowPerc(xtabs(~Sampling_Site+thermo_y_n, data=new_wq))
png("../../results/thermo_y_n_site_table.png", height=400, width=400)
p<-tableGrob(thermo_y_n_site)
grid.arrange(p)
dev.off()
```



## Tables Part 2:  Pathogens
Frequency of occurence for the various pathogens we tested.
```{r Arco by Pond}
#Arco positives by site 
#make two way table, computer row percents, save table
xtabs(~Pond+arco_y_n, data=new_wq)
Arco_Pond<- rowPerc(xtabs(~Pond+arco_y_n, data=new_wq))
png("../../results/Arco_pond_table.png", height=400, width=400)
p<-tableGrob(Arco_Pond)
grid.arrange(p)
dev.off()

```

In the code chunk below I was trying to make Arco tables using the kable function as Dr. Handel suggested.
```{r Arco by pond make table pretty}

Arco_Pond %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>%
  save_kable(file = "../../results/Arco_Pond_table_4.png")


  #kable_as_image("../../results/test3")

#kableExtra::save_kable(Arco_Pond, file = "table.pdf")

  ##save_kable(file = "../../results/Arco_Pond_table_4.png")

##save(Arco_Pond, file = "../../results/Arco_Pond_table_2.RData")
```


Now I am trying xtable as Dr. Handel also suggested
```{r, results='asis'}
#print(xtable(head(Arco_Pond_2)), type="html")

library(xtable)
print(xtable(Arco_Pond), type='html')
```



Now lets do the rest of pathogens by sampling site. This is an interesting way to see if one sampling site is driving up the contamination at a particular sampling location (i.e., pond)
```{r campy by site - percent}
#Campy positives by site 
#make two way table, computer row percents, save table
xtabs(~Sampling_Site+Campy_y_n, data=new_wq)
campy_site<- rowPerc(xtabs(~Sampling_Site+Campy_y_n, data=new_wq))
png("../../results/campy_site_table.png", height=400, width=400)
p<-tableGrob(campy_site)
grid.arrange(p)
dev.off()
```

```{r arco positive by site - percent}
#Arco positives by site 
#make two way table, computer row percents, save table
xtabs(~Sampling_Site+arco_y_n, data=new_wq)
arco_site<- rowPerc(xtabs(~Sampling_Site+arco_y_n, data=new_wq))
png("../../results/arco_site_table.png", height=400, width=400)
p<-tableGrob(arco_site)
grid.arrange(p)
dev.off()


#save as df
save(arco_site, file = "../../results/saved_arco_site.RData")
```


```{r sal by site - percent}
#Salmonella positives by site 
#make two way table, computer row percents, save table
xtabs(~Sampling_Site+Salmonella_y_n, data=new_wq)
Salmonella_site<- rowPerc(xtabs(~Sampling_Site+Salmonella_y_n, data=new_wq))
png("../../results/salmonella_site_table.png", height=400, width=400)
p<-tableGrob(Salmonella_site)
grid.arrange(p)
dev.off()
```


## Tables part 3: Microbial source tracking markers 

We want to calc the frequency of occurance (FOO) for all microbial source tracking markers by pond. This will let us if one pond has a stronger source of contamination. For example, we may see that a pond lcoated in a dog park has more dog fecal contamination. Therefore, when looking at pathogens we may focus on zoonotic pathogens that are transferred from dog to human. 


```{r MST by Pond}
#make two way table, computer row percents, save table

#HF183 positives by site 
xtabs(~Pond+HF183_y_n, data=new_wq)
HF183_y_n_site<- rowPerc(xtabs(~Pond+HF183_y_n, data=new_wq))
png("../../results/HF183_y_n_pond_table.png", height=400, width=400)
p<-tableGrob(HF183_y_n_site)
grid.arrange(p)
dev.off()

#HumM2
xtabs(~Pond+HumM2_y_n, data=new_wq)
HumM2_y_n_site<- rowPerc(xtabs(~Pond+HumM2_y_n, data=new_wq))
png("../../results/HumM2_y_n_pond_table.png", height=400, width=400)
p<-tableGrob(HumM2_y_n_site)
grid.arrange(p)
dev.off()

#CG01 positives by site 
xtabs(~Pond+CG01_y_n, data=new_wq)
CG01_y_n_site<- rowPerc(xtabs(~Pond+CG01_y_n, data=new_wq))
png("../../results/CG01_y_n_pond_table.png", height=400, width=400)
p<-tableGrob(CG01_y_n_site)
grid.arrange(p)
dev.off()


#Dog3 positives by site 
xtabs(~Pond+Dog3_y_n, data=new_wq)
Dog3_y_n_site<- rowPerc(xtabs(~Pond+Dog3_y_n, data=new_wq))
png("../../results/Dog3_y_n_pond_table.png", height=400, width=400)
p<-tableGrob(Dog3_y_n_site)
grid.arrange(p)
dev.off()


#Rum2Bac positives by site 
xtabs(~Pond+Rum2Bac_y_n, data=new_wq)
Rum2Bac_y_n_site<- rowPerc(xtabs(~Pond+Rum2Bac_y_n, data=new_wq))
png("../../results/Rum2Bac_y_n_pond_table.png", height=400, width=400)
p<-tableGrob(Rum2Bac_y_n_site)
grid.arrange(p)
dev.off()

#LeeSg positives by site 
xtabs(~Pond+LeeSg_y_n, data=new_wq)
LeeSg_y_n_site<- rowPerc(xtabs(~Pond+LeeSg_y_n, data=new_wq))
png("../../results/LeeSg_y_n_pond_table.png", height=400, width=400)
p<-tableGrob(LeeSg_y_n_site)
grid.arrange(p)
dev.off()

#MuBac positives by site 
xtabs(~Pond+MuBac_y_n, data=new_wq)
MuBac_y_n_site<- rowPerc(xtabs(~Pond+MuBac_y_n, data=new_wq))
png("../../results/MuBac_y_n_pond_table.png", height=400, width=400)
p<-tableGrob(MuBac_y_n_site)
grid.arrange(p)
dev.off()
```
Great, now we have all the FOO tables by pond. Let's break that down further by site to see if there are any interesting patterns. 

Start with the human marker we saw most...
```{r HF183 by site - percent}
#HF183 positives by site 
#make two way table, computer row percents, save table
xtabs(~Sampling_Site+HF183_y_n, data=new_wq)
HF183_y_n_site<- rowPerc(xtabs(~Sampling_Site+HF183_y_n, data=new_wq))
png("../../results/HF183_y_n_site_table.png", height=400, width=400)
p<-tableGrob(HF183_y_n_site)
grid.arrange(p)
dev.off()
```
The second human marker....
```{r HumM2 by site - percent}
#HumM2 positives by site 
#make two way table, computer row percents, save table
xtabs(~Sampling_Site+HumM2_y_n, data=new_wq)
HumM2_y_n_site<- rowPerc(xtabs(~Sampling_Site+HumM2_y_n, data=new_wq))
png("../../results/HumM2_y_n_site_table.png", height=400, width=400)
p<-tableGrob(HumM2_y_n_site)
grid.arrange(p)
dev.off()
```
And now the rest of MST markers we saw in lower frequencies. 
```{r The REST..... positive by site - percent}
#CG01 positives by site
#make two way table, computer row percents, save table
xtabs(~Sampling_Site+CG01_y_n, data=new_wq)
CG01_y_n_site<- rowPerc(xtabs(~Sampling_Site+CG01_y_n, data=new_wq))
png("../../results/CG01_y_n_site_table.png", height=400, width=400)
p<-tableGrob(CG01_y_n_site)
grid.arrange(p)
dev.off()


#Dog3 positives by site 
#make two way table, computer row percents, save table
xtabs(~Sampling_Site+Dog3_y_n, data=new_wq)
Dog3_y_n_site<- rowPerc(xtabs(~Sampling_Site+Dog3_y_n, data=new_wq))
png("../../results/Dog3_y_n_site_table.png", height=400, width=400)
p<-tableGrob(Dog3_y_n_site)
grid.arrange(p)
dev.off()


#Rum2Bac positives by site 
#make two way table, computer row percents, save table
xtabs(~Sampling_Site+Rum2Bac_y_n, data=new_wq)
Rum2Bac_y_n_site<- rowPerc(xtabs(~Sampling_Site+Rum2Bac_y_n, data=new_wq))
png("../../results/Rum2Bac_y_n_site_table.png", height=400, width=400)
p<-tableGrob(Rum2Bac_y_n_site)
grid.arrange(p)
dev.off()

#LeeSg positives by site 
#make two way table, computer row percents, save table
xtabs(~Sampling_Site+LeeSg_y_n, data=new_wq)
LeeSg_y_n_site<- rowPerc(xtabs(~Sampling_Site+LeeSg_y_n, data=new_wq))
png("../../results/LeeSg_y_n_site_table.png", height=400, width=400)
p<-tableGrob(LeeSg_y_n_site)
grid.arrange(p)
dev.off()
```
# BAR PLOTS
Data: subseted forms 
After spending some time looking at the tables, I decided I wanted to try to show them in bar plot form...

First we need to subset out the specific ponds, so we can get percent positives for each pond.

```{r subset data for yes no varaibles}
McCall_Lake_2 <- subset(new_wq, Pond == "McCall_Lake")
Country_Hills_2 <- subset(new_wq, Pond == "Country_Hills")
Inverness_2 <- subset(new_wq, Pond == "Inverness")
```


```{r}
#https://www.sheffield.ac.uk/polopoly_fs/1.714591!/file/stcp-karadimitriou-categoricalR.pdf
arco_table <- table(McCall_Lake_2$arco_y_n)
arco_table
prop.table(arco_table)
round(100*prop.table(arco_table),digits=0)
```


```{r}
# Compute the frequency
library(dplyr)
McCall_Lake_3 <- McCall_Lake_2 %>%
  group_by(arco_y_n) %>%
  summarise(counts = n())
McCall_Lake_3
```
Let's start with FIB, then move to MST, and end with pathogens.

```{r Enterococcus by pond}
#we want this to say failure or pass instead of yes and no
McCall_Lake_2 <- McCall_Lake_2 %>% mutate(Entero_y_n= 
                      ifelse(Enterococcus_CCE < "3.102", "pass",
                      ifelse(Enterococcus_CCE > "3.103", "fail",
                      "pass")))
Inverness_2 <- Inverness_2 %>% mutate(Entero_y_n= 
                      ifelse(Enterococcus_CCE < "3.102", "pass",
                      ifelse(Enterococcus_CCE > "3.103", "fail",
                      "pass")))
Country_Hills_2 <- Country_Hills_2 %>% mutate(Entero_y_n= 
                      ifelse(Enterococcus_CCE < "3.102", "pass",
                      ifelse(Enterococcus_CCE > "3.103", "fail",
                      "pass")))

#we need the title to be in atlics 
title_4 <- expression(paste(italic("Enterococcus"), " spp."))
title_5 <- expression(paste ("Frequency of Occurance of Water Quality Failures based on" (italic("Enterococcus"), "spp.")))

#remove NA

McCall_Lake_2 = McCall_Lake_2 %>%
  filter(Entero_y_n != "NA")

#graph mccall
McCall_Entero_percent_bar <- ggplot(McCall_Lake_2, aes(x = Entero_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#F08080", fill = "#F08080") +
        xlab(title_4) +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
        ggtitle("McCall Lake") +
        theme_pubclean()
McCall_Entero_percent_bar
 
#graph country Hills
Country_entero_percent_bar <- ggplot(Country_Hills_2, aes(x = Entero_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#DC143C", fill = "#DC143C") +
        xlab(title_4) +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
        ggtitle("Country Hills") +
  theme_pubclean()
Country_entero_percent_bar

#graph inverness
Inverness_entero_percent_bar <- ggplot(Inverness_2, aes(x = Entero_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#8B0000", fill = "#8B0000") +
        xlab(title_4) +
  ggtitle("Inverness") +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme_pubclean()
Inverness_entero_percent_bar

#arrange them all together
entero_percent_bar <- grid.arrange(McCall_Entero_percent_bar, Country_entero_percent_bar, Inverness_entero_percent_bar, top = "Frequency of Occurance of Water Quality Failures by Pond" , nrow=2)
ggsave(filename = "../../results/entero_percent_bar_2.png",plot = entero_percent_bar)
```

If i want to look at the water quality indicators by sampling site, i need to subset by sampling site, like I did with pond above. Let's do that.

```{r subset by sampling site}
#McCall first
ML2 <- subset(McCall_Lake_2, Sampling_Site == "Outfall ML2")
ML1 <- subset(McCall_Lake_2, Sampling_Site == "Outfall ML1")
Inlet_.75 <- subset(McCall_Lake_2, Sampling_Site == "Inlet 3/4")
PR60 <- subset(McCall_Lake_2, Sampling_Site == "Inlet PR60")

#Country Hills
WP31A <- subset(Country_Hills_2, Sampling_Site == "Outfall WP31A")
WP31B <- subset(Country_Hills_2, Sampling_Site == "Inlet WP31B")
WP31C <- subset(Country_Hills_2, Sampling_Site == "Outfall WP31C")
WP31D <- subset(Country_Hills_2, Sampling_Site == "Outfall WP31D")
WP31E <- subset(Country_Hills_2, Sampling_Site == "Outfall WP31E")

#Inverness
Outfall_Inlet <- subset(Inverness_2, Sampling_Site == "Outfall_Inlet")
WP26B <- subset(Inverness_2, Sampling_Site == "Outfall WP26B")
WP26C <- subset(Inverness_2, Sampling_Site == "Outfall WP26C")
WP26D <- subset(Inverness_2, Sampling_Site == "Outfall WP26D")
```

```{r Entero by site}
#we need the title to be in atlics 
title_4 <- expression(paste(italic("Enterococcus"), " spp."))
title_5 <- expression(paste ("Frequency of Occurance of Water Quality Failures based on" (italic("Enterococcus"), "spp.")))

#remove NA

McCall_Lake_2 = McCall_Lake_2 %>%
  filter(Entero_y_n != "NA")

#graph mccall
ML2_Entero_percent_bar <- ggplot(ML2, aes(x = Entero_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#FF8C00", fill = "#FF8C00") +
        xlab(title_4) +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
        ggtitle("ML2") +
        theme_pubclean()
ML2_Entero_percent_bar
 

ML1_entero_percent_bar <- ggplot(ML1, aes(x = Entero_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#FF8C00", fill = "#FF8C00") +
        xlab(title_4) +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
        ggtitle("ML1") +
  theme_pubclean()
ML1_entero_percent_bar

PR60_entero_percent_bar <- ggplot(PR60, aes(x = Entero_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#FF8C00", fill = "#FF8C00") +
        xlab(title_4) +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
        ggtitle("ML1") +
  theme_pubclean()
PR60_entero_percent_bar

Inlet_.75_entero_percent_bar <- ggplot(Inlet_.75, aes(x = Entero_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#FF8C00", fill = "#FF8C00") +
        xlab(title_4) +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
        ggtitle("Inlet 3/4") +
  theme_pubclean()
Inlet_.75_entero_percent_bar
McCall_entero_percent_bar <- grid.arrange(ML2_Entero_percent_bar, ML1_entero_percent_bar, PR60_entero_percent_bar, Inlet_.75_entero_percent_bar, top = "Frequency of Occurance of Water Quality Failures by Sampling Site in McCall Lake" , nrow=2)
ggsave(filename = "../../results/McCall_entero_percent_bar_sampling_site.png",plot = McCall_entero_percent_bar)


#graph country Hills
WP31A_entero_percent_bar <- ggplot(WP31A, aes(x = Entero_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#FFD700", fill = "#FFD700") +
        xlab(title_4) +
  ggtitle("WP31A") +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme_pubclean()
WP31A_entero_percent_bar

WP31B_entero_percent_bar <- ggplot(WP31B, aes(x = Entero_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#FFD700", fill = "#FFD700") +
        xlab(title_4) +
  ggtitle("WP31B") +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme_pubclean()
WP31A_entero_percent_bar

WP31C_entero_percent_bar <- ggplot(WP31C, aes(x = Entero_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#FFD700", fill = "#FFD700") +
        xlab(title_4) +
  ggtitle("WP31C") +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme_pubclean()
WP31A_entero_percent_bar

WP31D_entero_percent_bar <- ggplot(WP31D, aes(x = Entero_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#FFD700", fill = "#FFD700") +
        xlab(title_4) +
  ggtitle("WP31D") +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme_pubclean()
WP31A_entero_percent_bar

WP31E_entero_percent_bar <- ggplot(WP31E, aes(x = Entero_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#FFD700", fill = "#FFD700") +
        xlab(title_4) +
  ggtitle("WP31E") +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme_pubclean()
WP31A_entero_percent_bar

Country_sites_percent_bar <- grid.arrange( WP31A_entero_percent_bar, WP31B_entero_percent_bar, WP31C_entero_percent_bar, WP31D_entero_percent_bar, WP31E_entero_percent_bar, top = "Frequency of Occurance of Water Quality Failures by Sampling Site in Country Hills" , nrow=2)
ggsave(filename = "../../results/Country_Hills_entero_percent_bar_sampling_site.png",plot = Country_sites_percent_bar)

#graph inverness
outfall_inlet_entero_percent_bar <- ggplot(Outfall_Inlet, aes(x = Entero_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#FF4500", fill = "#FF4500") +
        xlab(title_4) +
  ggtitle("Outfall Inlet") +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme_pubclean()
outfall_inlet_entero_percent_bar
WP26B_entero_percent_bar <- ggplot(WP26B, aes(x = Entero_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#FF4500", fill = "#FF4500") +
        xlab(title_4) +
  ggtitle("WP26B") +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme_pubclean()
WP26B_entero_percent_bar
WP26C_entero_percent_bar <- ggplot(WP26C, aes(x = Entero_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#FF4500", fill = "#FF4500") +
        xlab(title_4) +
  ggtitle("WP26C") +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme_pubclean()
WP26C_entero_percent_bar
WP26D_entero_percent_bar <- ggplot(WP26D, aes(x = Entero_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#FF4500", fill = "#FF4500") +
        xlab(title_4) +
  ggtitle("WP26D") +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme_pubclean()
WP26D_entero_percent_bar

Inverness_sites_percent_bar <- grid.arrange(outfall_inlet_entero_percent_bar, WP26B_entero_percent_bar, WP26C_entero_percent_bar, WP26D_entero_percent_bar, top = "Frequency of Occurance of Water Quality Failures by Sampling Site in Inverness" , nrow=2)
ggsave(filename = "../../results/Inverness_entero_percent_bar_sampling_site.png",plot = Inverness_sites_percent_bar)

#arrange them all together
sites_percent_bar <- grid.arrange(ML2_Entero_percent_bar, ML1_entero_percent_bar, PR60_entero_percent_bar, Inlet_.75_entero_percent_bar, WP31A_entero_percent_bar, WP31B_entero_percent_bar, WP31C_entero_percent_bar, WP31D_entero_percent_bar, WP31E_entero_percent_bar, outfall_inlet_entero_percent_bar, WP26B_entero_percent_bar, WP26C_entero_percent_bar, WP26D_entero_percent_bar, top = "Frequency of Occurance of Water Quality Failures by Sampling Site" , nrow=4)
ggsave(filename = "../../results/entero_percent_bar_sampling_site.png",plot = sites_percent_bar)
```



```{r Human for all sampling site - percent - barchart}
#start with HF183

McCall_HF183_percent_bar <- ggplot(McCall_Lake_2, aes(x = HF183_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#228B22", fill = "#228B22") +
        xlab("HF183") +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
        ggtitle("McCall Lake") +
        theme_pubclean()
McCall_HF183_percent_bar
 
Country_HF183_percent_bar <- ggplot(Country_Hills_2, aes(x = HF183_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#2E8B57", fill = "#2E8B57") +
        xlab("HF183") +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
        ggtitle("Country Hills") +
  theme_pubclean()
Country_HF183_percent_bar

Inverness_HF183_percent_bar <- ggplot(Inverness_2, aes(x = HF183_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#98FB98", fill = "#98FB98") +
        xlab("HF183") +
  ggtitle("Inverness") +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme_pubclean()
Inverness_HF183_percent_bar

#Now HumM2
McCall_HumM2_percent_bar <- ggplot(McCall_Lake_2, aes(x = HumM2_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#228B22", fill = "#228B22") +
        xlab("HumM2") +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
        ggtitle("McCall Lake") +
        theme_pubclean()
McCall_HumM2_percent_bar
 
Country_HumM2_percent_bar <- ggplot(Country_Hills_2, aes(x = HumM2_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#2E8B57", fill = "#2E8B57") +
        xlab("HumM2") +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
        ggtitle("Country Hills") +
  theme_pubclean()
Country_HumM2_percent_bar

Inverness_HumM2_percent_bar <- ggplot(Inverness_2, aes(x = HumM2_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#98FB98", fill = "#98FB98") +
        xlab("HumM2") +
  ggtitle("Inverness") +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme_pubclean()
Inverness_HumM2_percent_bar

#arrange them all together
Human_percent_bar <- grid.arrange(McCall_HF183_percent_bar, Country_HF183_percent_bar, Inverness_HF183_percent_bar, McCall_HumM2_percent_bar, Country_HumM2_percent_bar, Inverness_HumM2_percent_bar, top = "Human (HF183, HumM2) Source Tracking Markers" , nrow=2)
ggsave(filename = "../../results/human_percent_bar_2.png",plot = Human_percent_bar)

```

```{r Birds for all sampling site - percent - barchart}


McCall_CG01_percent_bar <- ggplot(McCall_Lake_2, aes(x = CG01_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#DA70D6", fill = "#DA70D6") +
        xlab("CG01") +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
        ggtitle("McCall Lake") +
        theme_pubclean()
McCall_CG01_percent_bar
 
Country_CG01_percent_bar <- ggplot(Country_Hills_2, aes(x = CG01_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#9400D3", fill = "#9400D3") +
        xlab("CG01") +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
        ggtitle("Country Hills") +
  theme_pubclean()
Country_CG01_percent_bar

Inverness_CG01_percent_bar <- ggplot(Inverness_2, aes(x = CG01_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#4B0082", fill = "#4B0082") +
        xlab("CG01") +
  ggtitle("Inverness") +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme_pubclean()
Inverness_CG01_percent_bar


McCall_LeeSg_percent_bar <- ggplot(McCall_Lake_2, aes(x = LeeSg_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#DA70D6", fill = "#DA70D6") +
        xlab("LeeSg") +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
        ggtitle("McCall Lake") +
        theme_pubclean()
McCall_LeeSg_percent_bar
 
Country_LeeSg_percent_bar <- ggplot(Country_Hills_2, aes(x = LeeSg_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#9400D3", fill = "#9400D3") +
        xlab("LeeSg") +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
        ggtitle("Country Hills") +
  theme_pubclean()
Country_LeeSg_percent_bar

Inverness_LeeSg_percent_bar <- ggplot(Inverness_2, aes(x = LeeSg_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#4B0082", fill = "#4B0082") +
        xlab("LeeSg") +
  ggtitle("Inverness") +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme_pubclean()
Inverness_LeeSg_percent_bar


Human_percent_bar <- grid.arrange(McCall_CG01_percent_bar, Country_CG01_percent_bar, Inverness_CG01_percent_bar, McCall_LeeSg_percent_bar, Country_LeeSg_percent_bar, Inverness_LeeSg_percent_bar, top = "Bird (CG01, LeeSg) Source Tracking Markers" , nrow=2)
ggsave(filename = "../../results/bird_percent_bar.png",plot = Human_percent_bar)

```


```{r Pathogens for all sampling site - percent - barchart}

# we want our titles to be correct so we have to put the pathogen names in italics 
title <- expression(paste(italic("A. butzleri")))
title_2 <- expression(paste(italic("Campylobacter"), " spp."))
title_3 <- expression(paste(italic("Salmonella"), " spp."))

#lets start with acro
McCall_arco_percent_bar <- ggplot(McCall_Lake_2, aes(x = arco_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#7676ff", fill = "#7676ff") +
        xlab(title) +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
        ggtitle("McCall Lake") +
        theme_pubclean()
McCall_arco_percent_bar
 
Country_arco_percent_bar <- ggplot(Country_Hills_2, aes(x = arco_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#9d9dff", fill = "#9d9dff") +
        xlab(title) +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
        ggtitle("Country Hills") +
  theme_pubclean()
Country_arco_percent_bar

Inverness_arco_percent_bar <- ggplot(Inverness_2, aes(x = arco_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#3131ce", fill = "#3131ce") +
        xlab(title) +
  ggtitle("Inverness") +
        scale_y_continuous(labels = scales::percent, name = "Frequency") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme_pubclean()
Inverness_arco_percent_bar

#Time for campylobacter spp.

McCall_campy_percent_bar <- ggplot(McCall_Lake_2, aes(x = Campy_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#7676ff", fill = "#7676ff") +
        xlab(title_2) +
        scale_y_continuous(labels = scales::percent, name = "Proportion") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
        ggtitle("McCall Lake") +
        theme_pubclean()
McCall_campy_percent_bar
 
Country_campy_percent_bar <- ggplot(Country_Hills_2, aes(x = Campy_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#9d9dff", fill = "#9d9dff") +
        xlab(title_2) +
        scale_y_continuous(labels = scales::percent, name = "Proportion") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
        ggtitle("Country Hills") +
  theme_pubclean()
Country_campy_percent_bar

Inverness_campy_percent_bar <- ggplot(Inverness_2, aes(x = Campy_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#3131ce", fill = "#3131ce") +
        xlab(title_2) +
  ggtitle("Inverness") +
        scale_y_continuous(labels = scales::percent, name = "Proportion") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme_pubclean()
Inverness_campy_percent_bar


#Salmonella spp. 
McCall_sal_percent_bar <- ggplot(McCall_Lake_2, aes(x = Salmonella_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#7676ff", fill = "#7676ff") +
        xlab(title_3) +
        scale_y_continuous(labels = scales::percent, name = "Proportion") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
        ggtitle("McCall Lake") +
        theme_pubclean()
McCall_sal_percent_bar
 
Country_sal_percent_bar <- ggplot(Country_Hills_2, aes(x = Salmonella_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#9d9dff", fill = "#9d9dff") +
        xlab(title_3) +
        scale_y_continuous(labels = scales::percent, name = "Proportion") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
        ggtitle("Country Hills") +
  theme_pubclean()
Country_sal_percent_bar

Inverness_sal_percent_bar <- ggplot(Inverness_2, aes(x = Salmonella_y_n)) +
        geom_bar(aes(y = (..count..)/sum(..count..)), color = "#3131ce", fill = "#3131ce") +
        xlab(title_3) +
  ggtitle("Inverness") +
        scale_y_continuous(labels = scales::percent, name = "Proportion") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme_pubclean()
Inverness_sal_percent_bar

arco_percent_bar <- grid.arrange(McCall_arco_percent_bar, Country_arco_percent_bar, Inverness_arco_percent_bar, McCall_campy_percent_bar, Country_campy_percent_bar, Inverness_campy_percent_bar, McCall_sal_percent_bar, Country_sal_percent_bar, Inverness_sal_percent_bar, nrow = 3, top= "Pathogens in Stormwater Ponds")
ggsave(filename = "../../results/arco_percent_bar.png",plot = arco_percent_bar)
```

# LINE GRAPHS
Data: clean_data
First lets look at line graphs by sampling site. 
```{r load libraries for line graphs}
library('gridExtra')
library('ggplot2')
```


```{r set up the data}
#it stays the same but i want to shorten the name
clean_data <- clean_water_quality_data
```


Due to high levels of contamination in McCall lake, i want to seperate out the sites to see if there are any patterns. 
```{r subset by site}
ML2 <- subset(clean_data, Sampling_Site == "Outfall ML2")
ML1 <- subset(clean_data, Sampling_Site == "Outfall ML1")
PR60 <- subset(clean_data, Sampling_Site == "Inlet PR60")
Inlet_34 <- subset(clean_data, Sampling_Site == "Inlet 3/4")
```
I also want to subset the ponds, to look at ponds more indvidually
```{r subset by pond}
McCall_Lake <- subset(clean_data, Pond == "McCall_Lake")
Inverness <- subset(clean_data, Pond == "Inverness")
Country_Hills <- subset(clean_data, Pond == "Country_Hills")
```

## Line graphs - Microbial Source Tracking Markers
HF183 is a huge source of contamination. Let's see if that has any temporal trends associated with it, so we can understand the data better. 
```{r Temporal Trend: HF183 at each pond by site}
#Need to fix as some of it is getting cut off 
#want to add arrows pointing at holidays (https://www.r-bloggers.com/point-arrows-to-specific-parts-of-the-data-2/)

HF183_at_McCall <- ggplot(McCall_Lake, aes(x = Date_Sampled, y = HF183, color = Sampling_Site)) + geom_line() +
  geom_point() +
  geom_hline(yintercept = 3.67, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(3.2, 6.3) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 6), legend.title=element_text(size=5)) +
  labs(color = "McCall Sampling Sites") +
  annotate("segment", x= as.Date("2017-07-03"), xend = as.Date("2017-07-03"), y = 6, yend = 5, arrow = arrow(), size = 1) +
  annotate("segment", x= as.Date("2017-05-22"), xend = as.Date("2017-05-22"), y = 6, yend = 5, arrow = arrow(), size = 1) +
  annotate("segment", x= as.Date("2017-08-07"), xend = as.Date("2017-08-07"), y = 6, yend = 5, arrow = arrow(), size = 1) +
  annotate("segment", x= as.Date("2017-09-03"), xend = as.Date("2017-09-03"), y = 6, yend = 5, arrow = arrow(), size = 1)
  

HF183_at_McCall
ggsave(filename = "../../results/HF183_at_McCall.png",plot = HF183_at_McCall)

HF183_at_Country_Hills <- ggplot(Country_Hills, aes(x = Date_Sampled, y = HF183, color = Sampling_Site)) + geom_line() +
  geom_point() +
  geom_hline(yintercept = 3.67, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(3.2, 6.3) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 6), legend.title=element_text(size=5)) +
  labs(color = "Country Hills Sampling Sites") +
  annotate("segment", x= as.Date("2017-07-03"), xend = as.Date("2017-07-03"), y = 6, yend = 5, arrow = arrow(), size = 1) +
  annotate("segment", x= as.Date("2017-05-22"), xend = as.Date("2017-05-22"), y = 6, yend = 5, arrow = arrow(), size = 1) +
  annotate("segment", x= as.Date("2017-08-07"), xend = as.Date("2017-08-07"), y = 6, yend = 5, arrow = arrow(), size = 1) +
  annotate("segment", x= as.Date("2017-09-03"), xend = as.Date("2017-09-03"), y = 6, yend = 5, arrow = arrow(), size = 1)
  

HF183_at_Country_Hills  
ggsave(filename = "../../results/HF183_at_Country_Hills.png",plot = HF183_at_Country_Hills)

HF183_at_Inverness <- ggplot(Inverness, aes(x = Date_Sampled, y = HF183, color = Sampling_Site)) + geom_line() +
  geom_point() +
  geom_hline(yintercept = 3.67, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(3.2, 6.3) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 6), legend.title=element_text(size=5)) +
  labs(color = "Inverness Sampling Sites") +
  annotate("segment", x= as.Date("2017-07-03"), xend = as.Date("2017-07-03"), y = 6, yend = 5, arrow = arrow(), size = 1) +
  annotate("segment", x= as.Date("2017-05-22"), xend = as.Date("2017-05-22"), y = 6, yend = 5, arrow = arrow(), size = 1) +
  annotate("segment", x= as.Date("2017-08-07"), xend = as.Date("2017-08-07"), y = 6, yend = 5, arrow = arrow(), size = 1) +
  annotate("segment", x= as.Date("2017-09-03"), xend = as.Date("2017-09-03"), y = 6, yend = 5, arrow = arrow(), size = 1)
  
  

HF183_at_Inverness
ggsave(filename = "../../results/HF183_at_Inverness.png",plot = HF183_at_Inverness)

HF183_all_arranged <- grid.arrange(HF183_at_McCall, HF183_at_Country_Hills, HF183_at_Inverness)

ggsave(filename = "../../results/HF183_all_arranged.png",plot = HF183_all_arranged)
```


```{r Temp trend: HumM2 at each pond by site}


HumM2_at_McCall <- ggplot(McCall_Lake, aes(x = Date_Sampled, y = HumM2, color = Sampling_Site)) + geom_line() +
  geom_point() +
  geom_hline(yintercept = 4.14, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(3.2, 6) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 6), legend.title=element_text(size=5)) +
  labs(color = "McCall Sampling Sites")
  

HumM2_at_McCall
ggsave(filename = "../../results/HumM2_at_McCall.png",plot = HumM2_at_McCall)

HumM2_at_Country_Hills <- ggplot(Country_Hills, aes(x = Date_Sampled, y = HumM2, color = Sampling_Site)) + geom_line() +
  geom_point() +
  geom_hline(yintercept = 4.14, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(3.2, 6) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 6), legend.title=element_text(size=5)) +
  labs(color = "Country Hills Sampling Sites")

HumM2_at_Country_Hills  
ggsave(filename = "../../results/HumM2_at_Country_Hills.png",plot = HumM2_at_Country_Hills)

HumM2_at_Inverness <- ggplot(Inverness, aes(x = Date_Sampled, y = HumM2, color = Sampling_Site)) + geom_line() +
  geom_point() +
  geom_hline(yintercept = 4.14, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(3.2, 6) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 6), legend.title=element_text(size=5)) +
  labs(color = "Inverness Sampling Sites")
  

HumM2_at_Inverness
ggsave(filename = "../../results/HumM2_at_Inverness.png",plot = HumM2_at_Inverness)

HumM2_all_arranged <- grid.arrange(HumM2_at_Country_Hills, HumM2_at_Inverness, HumM2_at_McCall)

ggsave(filename = "../../results/HumM2_all_arranged.png",plot = HumM2_all_arranged)
```


```{r Temp trend: CG01 at each pond by site}
#looking at canada goose contamination 
CGO1_at_McCall <- ggplot(McCall_Lake, aes(x = Date_Sampled, y = CG01, color = Sampling_Site)) + geom_line() +
  geom_point() +
  geom_hline(yintercept = 3.4, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(2.5, 6) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 6), legend.title=element_text(size=5)) +
  labs(color = "McCall Sampling Sites")
  

CGO1_at_McCall
ggsave(filename = "../../results/CGO1_at_McCall.png",plot = CGO1_at_McCall)

CG01_at_Country_Hills <- ggplot(Country_Hills, aes(x = Date_Sampled, y = CG01, color = Sampling_Site)) + geom_line() +
  geom_point() +
  geom_hline(yintercept = 3.4, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(2.5, 6) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 6), legend.title=element_text(size=5)) +
  labs(color = "Country Hills Sampling Sites")

CG01_at_Country_Hills  
ggsave(filename = "../../results/_at_Country_Hills.png",plot = CG01_at_Country_Hills)

CG01_at_Inverness <- ggplot(Inverness, aes(x = Date_Sampled, y = CG01, color = Sampling_Site)) + geom_line() +
  geom_point() +
  geom_hline(yintercept = 3.4, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(2.5, 6) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 6), legend.title=element_text(size=5)) +
  labs(color = "Inverness Sampling Sites")
  

CG01_at_Inverness
ggsave(filename = "../../results/CG01_at_Inverness.png",plot = CG01_at_Inverness)

HumM2_all_arranged <- grid.arrange(CG01_at_Country_Hills, CG01_at_Inverness, CGO1_at_McCall)

ggsave(filename = "../../results/HumM2_all_arranged.png",plot = HumM2_all_arranged)

```


```{r Temp Trend - Seagull - McCall}
#looking at seagull contamination by pond 

Seagull_at_McCall <- ggplot(McCall_Lake, aes(x = Date_Sampled, y = LeeSg, color = Sampling_Site)) + 
  geom_line() +
  geom_point() +
  geom_hline(yintercept = 3.28, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(3.15, 5) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 7), legend.title=element_text(size=7)) +
  labs(color = "McCall Sampling Sites") +
  annotate("segment", x= as.Date("2017-06-08"), xend = as.Date("2017-06-08"), y = 5, yend = 4.7, arrow = arrow(), size = 1) + 
  annotate("segment", x= as.Date("2017-05-25"), xend = as.Date("2017-05-25"), y = 5, yend = 4.7, arrow = arrow(), size = 1) +
 annotate("segment", x= as.Date("2017-09-13"), xend = as.Date("2017-09-13"), y = 5, yend = 4.7, arrow = arrow(), size = 1)
  


Seagull_at_McCall
ggsave(filename = "../../results/LeeSg_at_McCall.png",plot = Seagull_at_McCall)

Seagull_at_Inverness <- ggplot(Inverness, aes(x = Date_Sampled, y = LeeSg, color = Sampling_Site)) + 
  geom_line() +
  geom_point() +
  geom_hline(yintercept = 3.28, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(2.5, 5) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 7), legend.title=element_text(size=7)) +
  labs(color = "Inverness Sampling Sites") +
  annotate("segment", x= as.Date("2017-06-08"), xend = as.Date("2017-06-08"), y = 5, yend = 4.7, arrow = arrow(), size = 1) + 
  annotate("segment", x= as.Date("2017-05-25"), xend = as.Date("2017-05-25"), y = 5, yend = 4.7, arrow = arrow(), size = 1) +
 annotate("segment", x= as.Date("2017-09-13"), xend = as.Date("2017-09-13"), y = 5, yend = 4.7, arrow = arrow(), size = 1)
  


Seagull_at_Inverness
ggsave(filename = "../../results/LeeSg_at_Inverness.png",plot = Seagull_at_Inverness)

Seagull_at_Country_Hills <- ggplot(Country_Hills, aes(x = Date_Sampled, y = LeeSg, color = Sampling_Site)) + 
  geom_line() +
  geom_point() +
  geom_hline(yintercept = 3.28, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(2.5, 5) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 7), legend.title=element_text(size=7)) +
  labs(color = "Country Hills Sampling Sites") +
  annotate("segment", x= as.Date("2017-06-08"), xend = as.Date("2017-06-08"), y = 5, yend = 4.7, arrow = arrow(), size = 1) + 
  annotate("segment", x= as.Date("2017-05-25"), xend = as.Date("2017-05-25"), y = 5, yend = 4.7, arrow = arrow(), size = 1) +
 annotate("segment", x= as.Date("2017-09-13"), xend = as.Date("2017-09-13"), y = 5, yend = 4.7, arrow = arrow(), size = 1)
  


Seagull_at_Country_Hills
ggsave(filename = "../../results/LeeSg_at_Country_Hills.png",plot = Seagull_at_Country_Hills)

```


## Line graphs - pathogens

```{r Temp Trend: Arco at each pond by site}
#Now lets look at A. butzleri at each site

Arco_at_McCall <- ggplot(McCall_Lake, aes(x = Date_Sampled, y = A_butzleri_HSP60, color = Sampling_Site)) + geom_line() +
  geom_point() +
  geom_hline(yintercept = 3.69, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(3.2, 5.2) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 6), legend.title=element_text(size=5)) +
  labs(color = "McCall Sampling Sites") +
  annotate("segment", x= as.Date("2017-06-08"), xend = as.Date("2017-06-08"), y = 5.2, yend = 4.7, arrow = arrow(), size = 1) + annotate("segment", x= as.Date("2017-05-25"), xend = as.Date("2017-05-25"), y = 5.2, yend = 4.7, arrow = arrow(), size = 1) +
 annotate("segment", x= as.Date("2017-09-13"), xend = as.Date("2017-09-13"), y = 5.2, yend = 4.7, arrow = arrow(), size = 1) 
  

Arco_at_McCall
ggsave(filename = "../../results/Arco_at_McCall.png",plot = Arco_at_McCall)

Arco_at_Country_Hills <- ggplot(Country_Hills, aes(x = Date_Sampled, y = A_butzleri_HSP60, color = Sampling_Site)) + geom_line() +
  geom_point() +
  geom_hline(yintercept = 3.69, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(3.2, 5.2) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 6), legend.title=element_text(size=5)) +
  labs(color = "Country Hills Sampling Sites")

Arco_at_Country_Hills  
ggsave(filename = "../../results/Arco_at_Country_Hills.png",plot = Arco_at_Country_Hills)

Arco_at_Inverness <- ggplot(Inverness, aes(x = Date_Sampled, y = A_butzleri_HSP60, color = Sampling_Site)) + geom_line() +
  geom_point() +
  geom_hline(yintercept = 3.69, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(3.2, 5.2) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 6), legend.title=element_text(size=5)) +
  labs(color = "Inverness Sampling Sites")
  

Arco_at_Inverness
ggsave(filename = "../../results/Arco_at_Inverness.png",plot = Arco_at_Inverness)

Arco_all_arranged <- grid.arrange(Arco_at_Country_Hills, Arco_at_Inverness, Arco_at_McCall)

ggsave(filename = "../../results/Arco_all_arranged.png",plot = Arco_all_arranged)


```



COOCCURANCE PLOTS AND FIGURES
```{r Arco and HF183 co occurance}
#Two way tables
table_arco_human <- table(new_wq$arco_y_n, new_wq$HF183_y_n)
table_arco_human
#shows the numbers
margin.table(table_arco_human)
margin.table(table_arco_human, 1)
margin.table(table_arco_human, 2)
#gets the proportions (percents)
table_arco_human/margin.table(table_arco_human)
prop.table(table_arco_human) #prop.table is a command that will convert any table to proportions
#the yes-yes column in this table gives us the total number of samples positive for both variables out of all samples 
#mosiac plot of table
mosaicplot(table_arco_human, shade = TRUE, main= "Two-way table of samples that are positive for Arcobacter butzleri and HF183", xlab = "Arcobacter butzlier", ylab = "HF183")
#instruction from: https://www.cyclismo.org/tutorial/R/tables.html 
mosaicplot(table_arco_human, sort=c(2,1))


```



CORRELATION
```{r}
library(corrplot)
library(ggplot2)
corr_subset <- clean_data[c(8,9,10,11)]
corr_matrix_test <- cor(corr_subset)
corrplot(corr_matrix_test, method = "square")

#correlation with HF183, HumM2 and Arco
corr_subset <- clean_data[c(8,9,10,11,15)]
colnames(corr_subset) <- c("Human (HF183)", "Human (HumM2)", "Canada Goose (CG01)", "Seagull (LeeSg)", "A. butzleri (HSP60)")
#rownames(corr_subset) <- c("Human (HF183)", "Human (HumM2)", "Canada Goose (CG01)", "Seagull (LeeSg)", "A. butzleri (HSP60)")
corr_matrix_arco_human <- cor(corr_subset)
corr_matrix_arco_human_plot <- corrplot(corr_matrix_arco_human, method = "square")
corr_matrix_arco_human_plot

png(height=1800, width=1800, file="../../results/corrplot_arco_human_bird.png")
corr_plot = corrplot(corr_matrix_arco_human_plot, method = "square", tl.cex = 5)
dev.off()

#Lets get a little fancier and add numbers and specify the colors
png(height=1800, width=1800, pointsize = 15, file="../../results/corrplot_arco_human_bird_2.png")
corr_plot_2 = corrplot(corr_matrix_arco_human_plot, method=c("number"), addgrid.col = "gray50", tl.cex=3, 
         tl.col = "black", 
         col = colorRampPalette(c("yellow","green","navyblue"))(100))
corr_plot_2
dev.off()


corr_plot_2




```



KS Test
The KS statistic are way to measure the liklihood of observaing a value. 
```{r}
ks.test(McCall_Lake$HF183, McCall_Lake$HumM2)
ks.test(McCall_Lake$HF183, McCall_Lake$A_butzleri_HSP60)
t.test(McCall_Lake$HF183, McCall_Lake$HumM2)
#significant means you fail the null
#the null means they are equal to each other
# p value less than .05 means you reject the null
#these all reject the null are they are worng 

```
D represents the value of the test-statistic (difference), so the KS-statistic  and the p-value represents the likelihood of observing this particular value of D, or a "more extreme" value by pure chance.

LINEAR MODEL - SIMPLE

Linear models describe a continuous response variable as a function of one or more predictor variables. They can help you understand and predict the behavior of complex systems or analyze experimental, financial, and biological data.

We want to see if other biological inputs can predict the presence of A. butzleri. 
```{r}
#the website below was found to be useful 
#http://r-statistics.co/Linear-Regression.html
linearMod_HF183 <- lm(A_butzleri_HSP60 ~ HF183, data = clean_data)
print(linearMod_HF183)
modelSummary <- summary(linearMod_HF183)

linearMod_HumM2 <- lm(A_butzleri_HSP60 ~ HumM2, data = clean_data)
linearMod_LeeSg <- lm(A_butzleri_HSP60 ~ LeeSg, data = clean_data)
linearMod_CG01 <- lm(A_butzleri_HSP60 ~ CG01, data = clean_data)

lm_log_HF183 = broom::tidy(linearMod_HF183)
lm_log_HuMm2 = broom::tidy(linearMod_HumM2)
lm_log_LeeSg = broom::tidy(linearMod_LeeSg)
lm_log_CG01 = broom::tidy(linearMod_CG01)

lm_variables = bind_rows(lm_log_HF183, lm_log_HuMm2, lm_log_LeeSg, lm_log_CG01)
lm_variables = lm_variables %>% filter(term != "(Intercept)")

saveRDS(lm_variables, file = "../../results/resulttable_lm.rds")

lm_variables2 = bind_rows(lm_log_HF183, lm_log_HuMm2, lm_log_LeeSg, lm_log_CG01)

lm_variables2 <- lm_variables2
png("../../results/resulttable_lm_3.png", height=400, width=400)
p<-tableGrob(lm_variables2)
grid.arrange(p)
dev.off()


lm_variables <- lm_variables 
png("../../results/resulttable_lm_2.png", height=400, width=400)
p<-tableGrob(lm_variables)
grid.arrange(p)
dev.off()

#p value is showing if that level within the facotr that you testing is a signifncat predictor our ooutcome 
#if it less than .05 is has a signficiant affect on our outcome
#HF183, HumM2 and LeeSg are all signficant predictors 
```



