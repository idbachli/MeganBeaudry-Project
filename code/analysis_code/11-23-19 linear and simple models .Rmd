---
title: "11-22-19 Linear model and full fit"
author: "Megan Beaudry"
date: "11/22/2019"
output: html_document
---
```{r}
library(xtable)
library(caret)
library('tigerstats')
library('formattable')
library('gridExtra')
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Data loading and cleaning
We will again use the Norovirus dataset. 


```{r loaddata}
#Write code that loads the dataset 
#You can of course re-use code you wrote in the other file.
clean_water_quality_data <- readRDS("../../data/processed_data/clean_water_quality_data.rds")
clean_data <- clean_water_quality_data
```

## Data splitting 
Depending on the data and question, we might want to reserve some of the data for a final validation/testing step or not. Here, to illustrate this process and the idea of reserving some data for the very end, we'll split things into a train and test set. All the modeling will be done with the train set, and final evaluation of the model(s) happens on the test set. We use the `caret` package for this. 

```{r split-data}
#this code does the data splitting. I still assume that your data is stored in the `d` object.
#uncomment to run
set.seed(123)
#extract observations/rows for training, assign to new variable. 
#Extracts 70% of the data into the trainset
trainset <- caret::createDataPartition(y = clean_data$A_butzleri_HSP60 , p = 0.7, list = FALSE)
#subsets out the dataset
data_train = clean_data[trainset,] 
#do the same for the test set
data_test = clean_data[-trainset,] 
```

## A null model

Now let's begin with the model fitting. We'll start by looking at a _null model_, which is just the mean of the data. This is, of course, a stupid "model" but provides some baseline for performance.

```{r clean-na}
#write code that computes the RMSE for a null model, which is just the mean of the outcome
#remember that from now on until the end, everything happens with the training data
mean(clean_data$A_butzleri_HSP60)
```


LINEAR MODEL - SIMPLE

Linear models describe a continuous response variable as a function of one or more predictor variables. They can help you understand and predict the behavior of complex systems or analyze experimental, financial, and biological data.

We want to see if other biological inputs can predict the presence of A. butzleri. 
```{r}
#the website below was found to be useful 
#http://r-statistics.co/Linear-Regression.html
clean_data <- clean_water_quality_data
linearMod_HF183 <- lm(A_butzleri_HSP60 ~ HF183, data = clean_data)
print(linearMod_HF183)
modelSummary <- summary(linearMod_HF183)

linearMod_HumM2 <- lm(A_butzleri_HSP60 ~ HumM2, data = clean_data)
linearMod_LeeSg <- lm(A_butzleri_HSP60 ~ LeeSg, data = clean_data)
linearMod_CG01 <- lm(A_butzleri_HSP60 ~ CG01, data = clean_data)

lm_log_HF183 = broom::tidy(linearMod_HF183)
lm_log_HuMm2 = broom::tidy(linearMod_HumM2)
lm_log_LeeSg = broom::tidy(linearMod_LeeSg)
lm_log_CG01 = broom::tidy(linearMod_CG01)

lm_variables = bind_rows(lm_log_HF183, lm_log_HuMm2, lm_log_LeeSg, lm_log_CG01)
lm_variables = lm_variables %>% filter(term != "(Intercept)")

saveRDS(lm_variables, file = "../../results/resulttable_lm.rds")

lm_variables2 = bind_rows(lm_log_HF183, lm_log_HuMm2, lm_log_LeeSg, lm_log_CG01)

lm_variables2 <- lm_variables2
png("../../results/resulttable_lm_3.png", height=400, width=400)
p<-tableGrob(lm_variables2)
grid.arrange(p)
dev.off()


lm_variables <- lm_variables 
png("../../results/resulttable_lm_2.png", height=400, width=400)
p<-tableGrob(lm_variables)
grid.arrange(p)
dev.off()

#p value is showing if that level within the facotr that you testing is a signifncat predictor our ooutcome 
#if it less than .05 is has a signficiant affect on our outcome
#HF183, HumM2 and LeeSg are all signficant predictors 
```








