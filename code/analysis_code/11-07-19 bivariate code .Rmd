---
title: "Bivariate Analysis"
author: "Megan Beaudry"
date: "11/4/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r library}
library(readxl)
library(dplyr)
library(tidyverse)
library(forcats)
library(ggthemes)
library(plotly)
library(knitr)
library(naniar)
library(broom)
library(gridExtra)
library(zoo)
library(ggpubr)
library(ggplot2)
library(ggthemes)
library(RColorBrewer)
library(dplyr)
library(caret)
library(tidyverse)
```

## Including Plots

You can also embed plots, for example:

```{r load data}
clean_water_quality_data <- readRDS("../../data/processed_data/clean_water_quality_data.rds")
#if you get an error - this happens because you need to save the file first cause it refers to a relative path 
```



TABLES
Lets start with positives by site....
```{r load libraries}
library('tigerstats')
library('formattable')
library('gridExtra')
```

To do this we need to alter the data first 
```{r data cleaning for tables}
new_wq <- clean_water_quality_data
new_wq$arco_new <- new_wq$A_butzleri_HSP60
new_wq$HF183_new <- new_wq$HF183
unique(new_wq$arco_new)
str(new_wq)

#convert characters to categorical varaibles
new_wq$Pond <- as.factor(as.character(new_wq$Pond))
new_wq$Sampling_Site <- as.factor(as.character(new_wq$Sampling_Site))
new_wq$Sampling_Site <- as.factor(as.character(new_wq$Sampling_Site))
str(new_wq)

#want to convert a new column with acro as yes or no to get the percent of the samples positive 
#lets do arco first
new_wq <- new_wq %>% mutate(arco_y_n= 
                      ifelse(arco_new < "3.391993", "no",
                      ifelse(arco_new > "3.391994", "yes",
                      "no")))
#Now HF183 and the rest
new_wq <- new_wq %>% mutate(HF183_y_n= 
                      ifelse(HF183_new < "3.329601", "no",
                      ifelse(HF183_new > "3.329602", "yes",
                      "no")))
new_wq <- new_wq %>% mutate(HumM2_y_n= 
                      ifelse(HumM2 < "3.847449", "no",
                      ifelse(HumM2 > "3.847450", "yes",
                      "no")))
new_wq <- new_wq %>% mutate(CG01_y_n= 
                      ifelse(CG01 < "3.108565", "no",
                      ifelse(CG01 > "3.108566", "yes",
                      "no")))
new_wq <- new_wq %>% mutate(LeeSg_y_n= 
                      ifelse(LeeSg < "3.283979", "no",
                      ifelse(LeeSg > "3.283980", "yes",
                      "no")))
new_wq <- new_wq %>% mutate(Dog3_y_n= 
                      ifelse(Dog3 < "3.156549", "no",
                      ifelse(Dog3 > "3.156550", "yes",
                      "no")))
new_wq <- new_wq %>% mutate(MuBac_y_n= 
                      ifelse(MuBac < "3.554852", "no",
                      ifelse(MuBac > "3.554853", "yes",
                      "no")))
new_wq <- new_wq %>% mutate(Rum2Bac_y_n= 
                      ifelse(Rum2Bac < "3.457125", "no",
                      ifelse(Rum2Bac > "3.457126", "yes",
                      "no")))
new_wq <- new_wq %>% mutate(Salmonella_y_n= 
                      ifelse(Salmonella_spp_InvA < "3.170848", "no",
                      ifelse(Salmonella_spp_InvA > "3.170849", "yes",
                      "no")))
new_wq <- new_wq %>% mutate(Campy_y_n= 
                      ifelse(Campylobacter_spp_Van_Dkye < "3.554852", "no",
                      ifelse(Campylobacter_spp_Van_Dkye > "3.554853", "yes",
                      "no")))

#water quality indicators
new_wq <- new_wq %>% mutate(Entero_y_n= 
                      ifelse(Enterococcus_CCE < "3.102", "no",
                      ifelse(Enterococcus_CCE > "3.103", "yes",
                      "no")))

new_wq <- new_wq %>% mutate(thermo_y_n= 
                      ifelse(thermotolerant_coliforms < "2.602", "no",
                      ifelse(thermotolerant_coliforms > "2.603", "yes",
                      "no")))
```

```{r by pond - water quality - percent}
xtabs(~Pond+Entero_y_n, data=new_wq)
Entero_Pond<- rowPerc(xtabs(~Pond+Entero_y_n, data=new_wq))
png("../../results/Entero_pond_table.png", height=400, width=400)
p<-tableGrob(Entero_Pond)
grid.arrange(p)
dev.off()

xtabs(~Pond+thermo_y_n, data=new_wq)
thermo_pond<- rowPerc(xtabs(~Pond+thermo_y_n, data=new_wq))
png("../../results/thermo_pond_table.png", height=400, width=400)
p<-tableGrob(thermo_pond)
grid.arrange(p)
dev.off()
```

```{r by ponds - MST - percent}
xtabs(~Pond+HF183_y_n, data=new_wq)
HF183_y_n_pond<- rowPerc(xtabs(~Pond+HF183_y_n, data=new_wq))
png("../../results/HF183_y_n_pond_table.png", height=400, width=400)
p<-tableGrob(HF183_y_n_pond)
grid.arrange(p)
dev.off()

xtabs(~Pond+HumM2_y_n, data=new_wq)
HumM2_y_n_pond<- rowPerc(xtabs(~Pond+HumM2_y_n, data=new_wq))
png("../../results/HumM2_y_n_pond_table.png", height=400, width=400)
p<-tableGrob(HumM2_y_n_pond)
grid.arrange(p)
dev.off()


```

```{r campy by site - percent}
#Campy positives by site 
xtabs(~Sampling_Site+Campy_y_n, data=new_wq)
campy_site<- rowPerc(xtabs(~Sampling_Site+Campy_y_n, data=new_wq))
png("../../results/campy_site_table.png", height=400, width=400)
p<-tableGrob(campy_site)
grid.arrange(p)
dev.off()
```

```{r arco positive by site - percent}
#Arco positives by site 
xtabs(~Sampling_Site+arco_y_n, data=new_wq)
arco_site<- rowPerc(xtabs(~Sampling_Site+arco_y_n, data=new_wq))
png("../../results/arco_site_table.png", height=400, width=400)
p<-tableGrob(arco_site)
grid.arrange(p)
dev.off()
```



```{r sal by site - percent}
#Salmonella positives by site 
xtabs(~Sampling_Site+Salmonella_y_n, data=new_wq)
Salmonella_site<- rowPerc(xtabs(~Sampling_Site+Salmonella_y_n, data=new_wq))
png("../../results/salmonella_site_table.png", height=400, width=400)
p<-tableGrob(Salmonella_site)
grid.arrange(p)
dev.off()
```
```{r MST by Pond}
#HF183 positives by site 
xtabs(~Pond+HF183_y_n, data=new_wq)
HF183_y_n_site<- rowPerc(xtabs(~Pond+HF183_y_n, data=new_wq))
png("../../results/HF183_y_n_pond_table.png", height=400, width=400)
p<-tableGrob(HF183_y_n_site)
grid.arrange(p)
dev.off()

#HumM2
xtabs(~Pond+HumM2_y_n, data=new_wq)
HumM2_y_n_site<- rowPerc(xtabs(~Pond+HumM2_y_n, data=new_wq))
png("../../results/HumM2_y_n_pond_table.png", height=400, width=400)
p<-tableGrob(HumM2_y_n_site)
grid.arrange(p)
dev.off()

#CG01 positives by site 
xtabs(~Pond+CG01_y_n, data=new_wq)
CG01_y_n_site<- rowPerc(xtabs(~Pond+CG01_y_n, data=new_wq))
png("../../results/CG01_y_n_pond_table.png", height=400, width=400)
p<-tableGrob(CG01_y_n_site)
grid.arrange(p)
dev.off()


#Dog3 positives by site 
xtabs(~Pond+Dog3_y_n, data=new_wq)
Dog3_y_n_site<- rowPerc(xtabs(~Pond+Dog3_y_n, data=new_wq))
png("../../results/Dog3_y_n_pond_table.png", height=400, width=400)
p<-tableGrob(Dog3_y_n_site)
grid.arrange(p)
dev.off()


#Rum2Bac positives by site 
xtabs(~Pond+Rum2Bac_y_n, data=new_wq)
Rum2Bac_y_n_site<- rowPerc(xtabs(~Pond+Rum2Bac_y_n, data=new_wq))
png("../../results/Rum2Bac_y_n_pond_table.png", height=400, width=400)
p<-tableGrob(Rum2Bac_y_n_site)
grid.arrange(p)
dev.off()

#LeeSg positives by site 
xtabs(~Pond+LeeSg_y_n, data=new_wq)
LeeSg_y_n_site<- rowPerc(xtabs(~Pond+LeeSg_y_n, data=new_wq))
png("../../results/LeeSg_y_n_pond_table.png", height=400, width=400)
p<-tableGrob(LeeSg_y_n_site)
grid.arrange(p)
dev.off()

#MuBac positives by site 
xtabs(~Pond+MuBac_y_n, data=new_wq)
MuBac_y_n_site<- rowPerc(xtabs(~Pond+MuBac_y_n, data=new_wq))
png("../../results/MuBac_y_n_pond_table.png", height=400, width=400)
p<-tableGrob(MuBac_y_n_site)
grid.arrange(p)
dev.off()
```

```{r FH183 by site - percent}
#HF183 positives by site 
xtabs(~Sampling_Site+HF183_y_n, data=new_wq)
HF183_y_n_site<- rowPerc(xtabs(~Sampling_Site+HF183_y_n, data=new_wq))
png("../../results/HF183_y_n_site_table.png", height=400, width=400)
p<-tableGrob(HF183_y_n_site)
grid.arrange(p)
dev.off()
```

```{r HumM2 by site - percent}
#HumM2 positives by site 
xtabs(~Sampling_Site+HumM2_y_n, data=new_wq)
HumM2_y_n_site<- rowPerc(xtabs(~Sampling_Site+HumM2_y_n, data=new_wq))
png("../../results/HumM2_y_n_site_table.png", height=400, width=400)
p<-tableGrob(HumM2_y_n_site)
grid.arrange(p)
dev.off()
```

```{r The REST..... positive by site - percent}
#CG01 positives by site 
xtabs(~Sampling_Site+CG01_y_n, data=new_wq)
CG01_y_n_site<- rowPerc(xtabs(~Sampling_Site+CG01_y_n, data=new_wq))
png("../../results/CG01_y_n_site_table.png", height=400, width=400)
p<-tableGrob(CG01_y_n_site)
grid.arrange(p)
dev.off()


#Dog3 positives by site 
xtabs(~Sampling_Site+Dog3_y_n, data=new_wq)
Dog3_y_n_site<- rowPerc(xtabs(~Sampling_Site+Dog3_y_n, data=new_wq))
png("../../results/Dog3_y_n_site_table.png", height=400, width=400)
p<-tableGrob(Dog3_y_n_site)
grid.arrange(p)
dev.off()


#Rum2Bac positives by site 
xtabs(~Sampling_Site+Rum2Bac_y_n, data=new_wq)
Rum2Bac_y_n_site<- rowPerc(xtabs(~Sampling_Site+Rum2Bac_y_n, data=new_wq))
png("../../results/Rum2Bac_y_n_site_table.png", height=400, width=400)
p<-tableGrob(Rum2Bac_y_n_site)
grid.arrange(p)
dev.off()

#LeeSg positives by site 
xtabs(~Sampling_Site+LeeSg_y_n, data=new_wq)
LeeSg_y_n_site<- rowPerc(xtabs(~Sampling_Site+LeeSg_y_n, data=new_wq))
png("../../results/LeeSg_y_n_site_table.png", height=400, width=400)
p<-tableGrob(LeeSg_y_n_site)
grid.arrange(p)
dev.off()

#Entero by site
xtabs(~Sampling_Site+Entero_y_n, data=new_wq)
Entero_y_n_site<- rowPerc(xtabs(~Sampling_Site+Entero_y_n, data=new_wq))
png("../../results/Entero_y_n_site_table.png", height=400, width=400)
p<-tableGrob(Entero_y_n_site)
grid.arrange(p)
dev.off()

#Thermotoler coliforms by site
xtabs(~Sampling_Site+thermo_y_n, data=new_wq)
thermo_y_n_site<- rowPerc(xtabs(~Sampling_Site+thermo_y_n, data=new_wq))
png("../../results/thermo_y_n_site_table.png", height=400, width=400)
p<-tableGrob(thermo_y_n_site)
grid.arrange(p)
dev.off()
```


LINE GRAPHS
Data: clean_data
First lets look at line graphs by sampling site. 
```{r load libraries for line graphs}
library('gridExtra')
library('ggplot2')
```


```{r set up the data}
#it stays the same but i want to shorten the name
clean_data <- clean_water_quality_data
```

```{r subset by site}
ML2 <- subset(clean_data, Sampling_Site == "Outfall ML2")
ML1 <- subset(clean_data, Sampling_Site == "Outfall ML1")
PR60 <- subset(clean_data, Sampling_Site == "Inlet PR60")
Inlet_34 <- subset(clean_data, Sampling_Site == "Inlet 3/4")
```

```{r subset by pond}
McCall_Lake <- subset(clean_data, Pond == "McCall_Lake")
Inverness <- subset(clean_data, Pond == "Inverness")
Country_Hills <- subset(clean_data, Pond == "Country_Hills")
```

```{r Temporal Trend: HF183 at each pond by site}
#Need to fix as some of it is getting cut off 
#want to add arrows pointing at holidays (https://www.r-bloggers.com/point-arrows-to-specific-parts-of-the-data-2/)
#tried this: geom_segment(aes(x = Date_Sampled, y = 5.5, xend = Date_Sampled, yend = 4.5),
                  #arrow = arrow(length = unit(0.5, "cm")))

HF183_at_McCall <- ggplot(McCall_Lake, aes(x = Date_Sampled, y = HF183, color = Sampling_Site)) + geom_line() +
  geom_point() +
  geom_hline(yintercept = 3.67, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(3.2, 6.3) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 4), legend.title=element_text(size=5)) +
  labs(color = "McCall Sampling Sites") +
  annotate("segment", x= as.Date("2017-07-03"), xend = as.Date("2017-07-03"), y = 6, yend = 5, arrow = arrow(), size = 1) +
  annotate("segment", x= as.Date("2017-05-22"), xend = as.Date("2017-05-22"), y = 6, yend = 5, arrow = arrow(), size = 1) +
  annotate("segment", x= as.Date("2017-08-07"), xend = as.Date("2017-08-07"), y = 6, yend = 5, arrow = arrow(), size = 1) +
  annotate("segment", x= as.Date("2017-09-03"), xend = as.Date("2017-09-03"), y = 6, yend = 5, arrow = arrow(), size = 1)
  

HF183_at_McCall
ggsave(filename = "../../results/HF183_at_McCall.png",plot = HF183_at_McCall)

HF183_at_Country_Hills <- ggplot(Country_Hills, aes(x = Date_Sampled, y = HF183, color = Sampling_Site)) + geom_line() +
  geom_point() +
  geom_hline(yintercept = 3.67, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(3.2, 6.3) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 4), legend.title=element_text(size=5)) +
  labs(color = "Country Hills Sampling Sites") +
  annotate("segment", x= as.Date("2017-07-03"), xend = as.Date("2017-07-03"), y = 6, yend = 5, arrow = arrow(), size = 1) +
  annotate("segment", x= as.Date("2017-05-22"), xend = as.Date("2017-05-22"), y = 6, yend = 5, arrow = arrow(), size = 1) +
  annotate("segment", x= as.Date("2017-08-07"), xend = as.Date("2017-08-07"), y = 6, yend = 5, arrow = arrow(), size = 1) +
  annotate("segment", x= as.Date("2017-09-03"), xend = as.Date("2017-09-03"), y = 6, yend = 5, arrow = arrow(), size = 1)
  

HF183_at_Country_Hills  
ggsave(filename = "../../results/HF183_at_Country_Hills.png",plot = HF183_at_Country_Hills)

HF183_at_Inverness <- ggplot(Inverness, aes(x = Date_Sampled, y = HF183, color = Sampling_Site)) + geom_line() +
  geom_point() +
  geom_hline(yintercept = 3.67, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(3.2, 6.3) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 4), legend.title=element_text(size=5)) +
  labs(color = "Inverness Sampling Sites") +
  annotate("segment", x= as.Date("2017-07-03"), xend = as.Date("2017-07-03"), y = 6, yend = 5, arrow = arrow(), size = 1) +
  annotate("segment", x= as.Date("2017-05-22"), xend = as.Date("2017-05-22"), y = 6, yend = 5, arrow = arrow(), size = 1) +
  annotate("segment", x= as.Date("2017-08-07"), xend = as.Date("2017-08-07"), y = 6, yend = 5, arrow = arrow(), size = 1) +
  annotate("segment", x= as.Date("2017-09-03"), xend = as.Date("2017-09-03"), y = 6, yend = 5, arrow = arrow(), size = 1)
  
  

HF183_at_Inverness
ggsave(filename = "../../results/HF183_at_Inverness.png",plot = HF183_at_Inverness)

HF183_all_arranged <- grid.arrange(HF183_at_McCall, HF183_at_Country_Hills, HF183_at_Inverness)

ggsave(filename = "../../results/HF183_all_arranged.png",plot = HF183_all_arranged)
```

```{r Temp Trend: Arco at each pond by site}
#Need to fix as some of it is getting cut off 

Arco_at_McCall <- ggplot(McCall_Lake, aes(x = Date_Sampled, y = A_butzleri_HSP60, color = Sampling_Site)) + geom_line() +
  geom_point() +
  geom_hline(yintercept = 3.69, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(3.2, 5.2) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 4), legend.title=element_text(size=5)) +
  labs(color = "McCall Sampling Sites") +
  annotate("segment", x= as.Date("2017-06-08"), xend = as.Date("2017-06-08"), y = 5.2, yend = 4.7, arrow = arrow(), size = 1) + annotate("segment", x= as.Date("2017-05-25"), xend = as.Date("2017-05-25"), y = 5.2, yend = 4.7, arrow = arrow(), size = 1) +
 annotate("segment", x= as.Date("2017-09-13"), xend = as.Date("2017-09-13"), y = 5.2, yend = 4.7, arrow = arrow(), size = 1) 
  

Arco_at_McCall
ggsave(filename = "../../results/Arco_at_McCall.png",plot = Arco_at_McCall)

Arco_at_Country_Hills <- ggplot(Country_Hills, aes(x = Date_Sampled, y = A_butzleri_HSP60, color = Sampling_Site)) + geom_line() +
  geom_point() +
  geom_hline(yintercept = 3.69, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(3.2, 5.2) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 4), legend.title=element_text(size=5)) +
  labs(color = "Country Hills Sampling Sites")

Arco_at_Country_Hills  
ggsave(filename = "../../results/Arco_at_Country_Hills.png",plot = Arco_at_Country_Hills)

Arco_at_Inverness <- ggplot(Inverness, aes(x = Date_Sampled, y = A_butzleri_HSP60, color = Sampling_Site)) + geom_line() +
  geom_point() +
  geom_hline(yintercept = 3.69, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(3.2, 5.2) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 4), legend.title=element_text(size=5)) +
  labs(color = "Inverness Sampling Sites")
  

Arco_at_Inverness
ggsave(filename = "../../results/Arco_at_Inverness.png",plot = Arco_at_Inverness)

Arco_all_arranged <- grid.arrange(Arco_at_Country_Hills, Arco_at_Inverness, Arco_at_McCall)

ggsave(filename = "../../results/Arco_all_arranged.png",plot = Arco_all_arranged)


```


```{r Temp Trend: Arco at each pond by site}
```


```{r Temp trend: HumM2 at each pond by site}
#Need to fix as some of it is getting cut off 

HumM2_at_McCall <- ggplot(McCall_Lake, aes(x = Date_Sampled, y = HumM2, color = Sampling_Site)) + geom_line() +
  geom_point() +
  geom_hline(yintercept = 4.14, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(3.2, 6) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 4), legend.title=element_text(size=5)) +
  labs(color = "McCall Sampling Sites")
  

HumM2_at_McCall
ggsave(filename = "../../results/HumM2_at_McCall.png",plot = HumM2_at_McCall)

HumM2_at_Country_Hills <- ggplot(Country_Hills, aes(x = Date_Sampled, y = HumM2, color = Sampling_Site)) + geom_line() +
  geom_point() +
  geom_hline(yintercept = 4.14, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(3.2, 6) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 4), legend.title=element_text(size=5)) +
  labs(color = "Country Hills Sampling Sites")

HumM2_at_Country_Hills  
ggsave(filename = "../../results/HumM2_at_Country_Hills.png",plot = HumM2_at_Country_Hills)

HumM2_at_Inverness <- ggplot(Inverness, aes(x = Date_Sampled, y = HumM2, color = Sampling_Site)) + geom_line() +
  geom_point() +
  geom_hline(yintercept = 4.14, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(3.2, 6) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 4), legend.title=element_text(size=5)) +
  labs(color = "Inverness Sampling Sites")
  

HumM2_at_Inverness
ggsave(filename = "../../results/HumM2_at_Inverness.png",plot = HumM2_at_Inverness)

HumM2_all_arranged <- grid.arrange(HumM2_at_Country_Hills, HumM2_at_Inverness, HumM2_at_McCall)

ggsave(filename = "../../results/HumM2_all_arranged.png",plot = HumM2_all_arranged)
```

```{r Temp trend: CG01 at each pond by site}

CGO1_at_McCall <- ggplot(McCall_Lake, aes(x = Date_Sampled, y = CG01, color = Sampling_Site)) + geom_line() +
  geom_point() +
  geom_hline(yintercept = 3.4, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(2.5, 6) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 4), legend.title=element_text(size=5)) +
  labs(color = "McCall Sampling Sites")
  

CGO1_at_McCall
ggsave(filename = "../../results/CGO1_at_McCall.png",plot = CGO1_at_McCall)

CG01_at_Country_Hills <- ggplot(Country_Hills, aes(x = Date_Sampled, y = CG01, color = Sampling_Site)) + geom_line() +
  geom_point() +
  geom_hline(yintercept = 3.4, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(2.5, 6) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 4), legend.title=element_text(size=5)) +
  labs(color = "Country Hills Sampling Sites")

CG01_at_Country_Hills  
ggsave(filename = "../../results/_at_Country_Hills.png",plot = CG01_at_Country_Hills)

CG01_at_Inverness <- ggplot(Inverness, aes(x = Date_Sampled, y = CG01, color = Sampling_Site)) + geom_line() +
  geom_point() +
  geom_hline(yintercept = 3.4, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(2.5, 6) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 4), legend.title=element_text(size=5)) +
  labs(color = "Inverness Sampling Sites")
  

CG01_at_Inverness
ggsave(filename = "../../results/CG01_at_Inverness.png",plot = CG01_at_Inverness)

HumM2_all_arranged <- grid.arrange(CG01_at_Country_Hills, CG01_at_Inverness, CGO1_at_McCall)

ggsave(filename = "../../results/HumM2_all_arranged.png",plot = HumM2_all_arranged)

```
```{r Temp Trend - Seagull - McCall}
Seagull_at_McCall <- ggplot(McCall_Lake, aes(x = Date_Sampled, y = LeeSg, color = Sampling_Site)) + 
  geom_line() +
  geom_point() +
  geom_hline(yintercept = 3.28, colour = "black", linetype = "dotted") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw() +
  ylim(2.5, 5) +
  theme(axis.title.x = element_text( size = 7), axis.title.y = element_text( size = 7), legend.text = element_text( size = 7), legend.title=element_text(size=7)) +
  labs(color = "McCall Sampling Sites") +
  annotate("segment", x= as.Date("2017-06-08"), xend = as.Date("2017-06-08"), y = 5, yend = 4.7, arrow = arrow(), size = 1) + 
  annotate("segment", x= as.Date("2017-05-25"), xend = as.Date("2017-05-25"), y = 5, yend = 4.7, arrow = arrow(), size = 1) +
 annotate("segment", x= as.Date("2017-09-13"), xend = as.Date("2017-09-13"), y = 5, yend = 4.7, arrow = arrow(), size = 1)
  


Seagull_at_McCall
ggsave(filename = "../../results/LeeSg_at_McCall.png",plot = Seagull_at_McCall)

```

```{r}
Inverness_bird_Arco <- ggplot(Inverness) +
  geom_line(mapping = aes(x = Date_Sampled, y = CG01), color = "dark green") +
  geom_line(mapping = aes(x = Date_Sampled, y = LeeSg), color = "purple") +
  geom_line(mapping = aes(x = Date_Sampled, y = A_butzleri_HSP60), color = "navy") +
  geom_hline(yintercept = 3.4, colour = "dark green", linetype = "dotted") +
  geom_hline(yintercept = 3.58, colour = "purple", linetype = "dotted") + 
  geom_hline(yintercept = 3.69, colour = "navy", linetype = "dotted") +
  geom_point(mapping = aes(x = Date_Sampled, y = A_butzleri_HSP60), color = "navy") +
  geom_point(mapping = aes(x = Date_Sampled, y = CG01), color = "dark green") +
  geom_point(mapping = aes(x = Date_Sampled, y = LeeSg), color = "purple") +
  labs (x = "Date Sampled", y = "Log10 Copies/100mL") +
  theme_bw()

Inverness_bird_Arco
```

RASTER PLOTS
```{r}
raster_by_pond_HF183 <- ggplot(clean_data, aes(x = Date_Sampled, y = Pond, fill = HF183)) + geom_raster(interpolate = TRUE) + scale_fill_gradientn(colors = c("blue", "yellow", "red"))
raster_by_pond_HF183

raster_by_pond_Entero <- ggplot(clean_data, aes(x = Date_Sampled, y = Pond, fill = Enterococcus_CCE)) + geom_raster(interpolate = TRUE) + scale_fill_gradientn(colors = c("blue", "yellow", "purple"))
raster_by_pond_Entero



```

HEAT MAP
```{r}
#heatmap <- heatmap(clean_data, aes(x = , y = pond)) + geom_tile(aes(fill = HF183))
```

COOCCURANCE PLOTS AND FIGURES
```{r Arco and HF183 co occurance}
#Two way tables
table_arco_human <- table(new_wq$arco_y_n, new_wq$HF183_y_n)
table_arco_human
#shows the numbers
margin.table(table_arco_human)
margin.table(table_arco_human, 1)
margin.table(table_arco_human, 2)
#gets the proportions (percents)
table_arco_human/margin.table(table_arco_human)
prop.table(table_arco_human) #prop.table is a command that will convert any table to proportions
#the yes-yes column in this table gives us the total number of samples positive for both variables out of all samples 
#mosiac plot of table
mosaicplot(table_arco_human, shade = TRUE, main= "Two-way table of samples that are positive for Arcobacter butzleri and HF183", xlab = "Arcobacter butzlier", ylab = "HF183")
#instruction from: https://www.cyclismo.org/tutorial/R/tables.html 
mosaicplot(table_arco_human, sort=c(2,1))


```
```{r}
library(vcd)
#vdc::mosaicplot()
```


```{r}
#assoc_1 <- ggplot(data = clean_data) +
  #geom_mosaic(aes(x = A_butzleri_HSP60_A, fill=HF183), divider="hbar", na.rm=TRUE) + labs(x=" ", title='divider = "hbar"') 



   
```
CORRELATION
```{r}
library(corrplot)
library(ggplot2)
corr_subset <- clean_data[c(8,9,10,11)]
corr_matrix_test <- cor(corr_subset)
corrplot(corr_matrix_test, method = "square")

#correlation with HF183, HumM2 and Arco
corr_subset <- clean_data[c(8,9,15)]
corr_matrix_arco_human <- cor(corr_subset)
corr_matrix_arco_human_plot <- corrplot(corr_matrix_arco_human, method = "square")
corr_matrix_arco_human_plot
#Save it as a table
#png("../../results/corr_matrix_arco_human).png", height=400, width=400)
#p<-tableGrob(corr_matrix_arco_human_plot)
#grid.arrange(p)
#dev.off()
#png("../../results/corr_matrix_arco_human.png", height=400, width=400)
#p<-grob(corr_matrix_arco_human_plot)
#dev.off()

ggsave(filename = "../../results/corr_matrix_arco_human_plot.png",plot = corr_matrix_arco_human_plot)

```


T-TEST
```{r}
#clean_data %>%
  #t.test(A_butzleri_HSP60, HF183)

```


LINEAR MODEL - SIMPLE
Linear models describe a continuous response variable as a function of one or more predictor variables. They can help you understand and predict the behavior of complex systems or analyze experimental, financial, and biological data.

We want to see if other biological inputs can predict the presence of A. butzleri. 
```{r}
#http://r-statistics.co/Linear-Regression.html
linearMod <- lm(A_butzleri_HSP60 ~ HF183, data = clean_data)
print(linearMod)
modelSummary <- summary(linearMod)

```



